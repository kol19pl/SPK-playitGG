#!/bin/sh
# Copyright (C) 2000-2020 Synology Inc. All rights reserved.

### This script will execute ONLY when package upgraded.
### Actions before package upgraded.

PACKAGE_NAME="playitgg"
PACKAGE_DIR="/var/packages/${PACKAGE_NAME}/target"
BACKUP_DIR="/var/packages/${PACKAGE_NAME}/backup"

# Tworzenie folderu kopii zapasowej, jeśli nie istnieje
mkdir -p "${BACKUP_DIR}"

# Kopia zapasowa ważnych plików konfiguracyjnych
if [ -d "${PACKAGE_DIR}" ]; then
    echo "Tworzenie kopii zapasowej konfiguracji przed aktualizacją..."
    cp -r "${PACKAGE_DIR}/config" "${BACKUP_DIR}/config_backup"
fi

# Zatrzymanie usługi przed aktualizacją (jeśli działa)
if synoservice --status "${PACKAGE_NAME}" > /dev/null 2>&1; then
    echo "Zatrzymywanie usługi ${PACKAGE_NAME} przed aktualizacją..."
    synoservice --stop "${PACKAGE_NAME}"
fi

exit 0

